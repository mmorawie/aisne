#include <QApplication>
#include <QPushButton>

#include <QObject>
#include <QWidget>
#include <QGLWidget>
#include <QtGui>
#include <QtOpenGL> 
#include <QTimer>


#include <iostream>
#include <time.h>
#include <sys/time.h>

#include <string>
#include <cmath>
using namespace std;


#include <GL/gl.h>
#include <GL/glu.h>

//#define TEST
#define PML

#include "GLComponents/Font.h"
#include "GLComponents/Panel.h"
#include "GLComponents/Panel3d.h"

#include "Fdtd.h"
#include "Fdtd3d.h"
#include "Source.h"


class Form1: public QWidget {
	Q_OBJECT
	
	private:
		
		Panel3d * main;
		Fdtd3d * fdtd;
		Source * source;
		Source * source2;
		Source * source3;
		
		
	public: 
		Form1(): QWidget() {
			
			Font * f = new Font("res/monospaced/DroidSansMono.ttf", 12, Font::createRGBA(0,0,0,255), this);
			
			fdtd = new Fdtd3d(100,100, 110);
			
			//source = new GaussianBeam( (Fdtd::point){30, 100}, 20, 100, 30, fdtd); 
			source = new GaussianBeam3d( (Fdtd3d::point){50,50, 22}, 20, 100, 30, fdtd); 
			
			
			main = new Panel3d(this, f, fdtd);
			
			QTimer * timer = new QTimer(this);
			connect(timer, SIGNAL(timeout()), this, SLOT(run()));
			
			#ifndef PML
				timer->setInterval(20);
			#else
				timer->setInterval(1000);
			#endif
			timer->start();
				
		};
		
	
  private slots:
	void run(){
				if (fdtd->t < 99200) source->inject();
				fdtd->algorithmstep();
				main->update();
	};
   
  
};

#include "autogenerated/moc.cpp"


int main(int argc, char * argv[]) {
  QApplication app(argc, argv);

  Form1 form1;
  
  form1.show();

  return app.exec();

}
